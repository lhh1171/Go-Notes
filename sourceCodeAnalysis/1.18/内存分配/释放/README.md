# 释放

```go

                 +---------------+                    +----------------------+
                 | mheap         |                    | pageAlloc            |
+---------+      +---------------+                    +----------------------+
| sysUsed | <--- |  allocSpan   -|---+                |  scavengeStartGen    |
+---------+      +---------------+   |                +----------------------+
                 |  alloc        |   +-- h.pages ---> |  scavenge            |
                 +---------------+   |      ^         +----------------------+
                 |  scavengeAll -|---+      |         |  scavengeOne         |
                 +---------------+          |         +----------------------+
                        ^                   |         |  scavengeRangeLocked |
                        |                   |         +----------------------+
                        |                   |                    |
                  h.scavengeAll             |                    |
                        |                   |                    v
                 +--------------+           |              +-----------+
                 | FreeOSMemory |           |              | sysUnused |
                 +--------------+           |              +-----------+
                                            |
. . . . . . . . . . . . . . . . . . . . . . | . . . . . . . . . . . . . . . . .
                                            |        background scavenger
runtime.main                                |
+----------+                         +------------+
| gcenable | -- go bgscavenge -----> | bgscavenge |
+----------+                         +------------+
                                            ^
                                            |
                                            |
                 +--------+          +---------------+
                 | sysmon | -------> | wakeScavenger |
                 +--------+          +---------------+
```
