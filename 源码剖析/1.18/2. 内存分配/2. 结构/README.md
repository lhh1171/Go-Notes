# 结构

```go

+-----------------+                    +------------+
| mheap           |                    | pageAlloc  |
+-----------------+                    +------------+
|  alloc          |                    |  alloc     |
+-----------------+                    +------------+         {OS memory}
|  allocSpan      | ---+               |  free      |              ^
+-----------------+    |               +------------+              |
|  grow           |    |               |  grow      |              |
+-----------------+    +-- h.pages --> +------------+     +--------+---------+
|  freeSpan       |    |               |  sysGrow  -|---> | sysMap | sysUsed |
+-----------------+    |               +------------+     +--------+---------+
|  freeSpanLocked | ---+
+-----------------+ 
|  sysAlloc       |
+-----------------+ <-----------------------+
                                            |
                                            |
                           +----------+     |            +----------------+
                   +-----> | zerobase |     |            | mcentral       |
  +-----------+    |       +----------+     + <--------- +----------------+
  | newobject |    |                        ^            |  cacheSpan     |
  +-----------+    |                        |            +----------------+
  | mallocgc -|----+                        |            |  uncacheSpan   |
  +-----------+    |                        +----------> +----------------+
                   |                        |            |  grow          |
                   |                        |            +----------------+
                   |       +------------------+                 |
                   +-----> | mcache           |                 |
                           +------------------+                 v
                           |  allocLarge      |          +----------------+
                           +------------------+          | sweepLocked    |
                           |  nextFree       -|----+     +----------------+
                           +------------------+    |     |  sweep         |
                           |  refill          |    |     +----------------+
+-------------------+      +------------------+    |             |
| gcMarkTermination | ---> |  prepareForSweep |    |             |
+-------------------+      +------------------+    |             v
                           |  releaseAll      |    |     +----------------+
                           +------------------+    |     | mspan          |
                                                   |     +----------------+
                                                   +---> |  nextFreeIndex |
                                                         +----------------+

```
