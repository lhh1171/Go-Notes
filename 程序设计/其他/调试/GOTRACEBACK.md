# GOTRACEBACK

控制进程崩溃(`panic`,`runtime`)时输出的调用堆栈跟踪信息。 </br>

默认仅输出当前goroutine堆栈信息，返回错误码(exit code)，忽略运行时内部函数调用。

&nbsp;

* `none`：忽略堆栈跟踪信息。
* `single`：默认。
* `all`：所有goroutine堆栈信息。
* `system`：类似all，但堆栈信息包含运行时函数。
* `crash`：类似 system，但以操作系统规范退出。

&nbsp;

> 提示：crash 方式在UNIX系统中，会引发 SIGABIRT，生成core dump文件。</br>
> 也可在 crash 方式时，通过 `ctrl + \` 主动引发崩溃，生成 coredump 文件。

&nbsp;

```go
package main

import (
    "fmt"
    "time"
)

func test(id int) {
    panic(fmt.Sprintf("%d err", id))
}

func main() {
    for i := 0; i < 3; i++ {
        go test(i)
    }

    time.Sleep(time.Second)
}
```

&nbsp;

```bash
$ go build -o test
$ ulimit -c unlimited

$ GOTRACEBACK=crash ./test
Aborted (core dumped)
```

```bash
$ dlv core ./test core

(dlv) bt
 0  0x000000000045c041 in runtime.raise
    at /usr/local/go/src/runtime/sys_linux_amd64.s:168
 1  0x0000000000443865 in runtime.dieFromSignal
    at /usr/local/go/src/runtime/signal_unix.go:852
 2  0x0000000000443e36 in runtime.sigfwdgo
    at /usr/local/go/src/runtime/signal_unix.go:1066
 3  0x0000000000442587 in runtime.sigtrampgo
    at /usr/local/go/src/runtime/signal_unix.go:430
 4  0x000000000045cd8e in runtime.sigtrampgo
    at <autogenerated>:1
 5  0x000000000045c31d in runtime.sigtramp
    at /usr/local/go/src/runtime/sys_linux_amd64.s:361
 6  0x000000000045c420 in runtime.sigreturn
    at /usr/local/go/src/runtime/sys_linux_amd64.s:466
 7  0x000000000042ffc9 in runtime.crash
    at /usr/local/go/src/runtime/signal_unix.go:944
 8  0x000000000042ffc9 in runtime.fatalpanic
    at /usr/local/go/src/runtime/panic.go:1092
 9  0x000000000042f797 in runtime.gopanic
    at /usr/local/go/src/runtime/panic.go:941
10  0x000000000047e3a5 in main.test
    at ./main.go:9
11  0x000000000047e466 in main.main.func1
    at ./main.go:14
12  0x000000000045a741 in runtime.goexit
    at /usr/local/go/src/runtime/asm_amd64.s:1571
    
    
(dlv) frame 10
> runtime.raise() /usr/local/go/src/runtime/sys_linux_amd64.s:168 (PC: 0x45c041)
Warning: debugging optimized function
Frame 10: ./main.go:9 (PC: 47e3a5)
     4:     "fmt"
     5:     "time"
     6: )
     7:
     8: func test(id int) {
=>   9:     panic(fmt.Sprintf("%d err", id))
    10: }
    11:
    12: func main() {
    13:     for i := 0; i < 3; i++ {
    14:         go test(i)
```
