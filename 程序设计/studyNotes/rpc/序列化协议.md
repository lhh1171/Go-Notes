# 序列化协议对比

远程过程调用(RPC:Remote Procedure Call)过程中,服务器端和客户端要使用一样的编解码器,客户端使用JSON,服务端也返回JSON格式的数据.常用的编解码器有:msgpack、protobuf、jSON、Thrift等。


## JSON
JSON是一个通用的数据交换的格式,可以应用在很多语言中。

### JSON优缺点

#### 优点

1. 简单易用开发成本低。
2. 跨语言。
3. 轻量级数据交换。
4. 非冗长性(对比XML标签简单括号闭环)。

#### 缺点

1. 体积大,影响高并发。
2. 无版本检查,自己做兼容。
3. 片段的创建和验证过程比一般的XML复杂。
4. 缺乏命名空间导致信息混乱。

总结: 最简单最通用的应用协议,使用广泛，开发效率高，性能相对较低，维护成本较高。


## Protobuf

Protobuf是一种以有效并可扩展的格式编码结构化数据的方式。

### Protobuf优缺点

#### 优点
1. 跨语言，可自定义数据结构。
2. 字段被编号，新添加的字段不影响老结构。解决了向后兼容问题。
3. 自动化生成代码，简单易用。
4. 二进制消息，效率高，性能高。

#### 缺点
1. 二进制格式，可读性差。
2. 对象冗余，字段很多，生成的类较大，占用空间。
3. 默认不具备动态特性（可以通过动态定义生成消息类型或者动态编译支持）。

总结: 简单快速上手,高效兼容性强,维护成本高。


## Thrift

#### 优点

1. 序列化和RPC支持一站式解决，比pb更方便。
2. 跨语言，IDL接口定义语言，自动生成多语言文件。
3. 省流量，体积较小。
4. 包含完整的客户端/服务端堆栈，可快速实现RPC。
5. 为服务端提供了多种工作模式，如线程池模型、非阻塞模型。

#### 缺点

1. 早期版本问题较大，0.7以前有兼容性问题。
2. 不支持双通道。
3. rpc方法非线程安全，服务器容易被挂死，需要串行化。
4. 默认不具备动态特性（可以通过动态定义生成消息类型或者动态编译支持）。
5. 开发环境、编译较麻烦。

总结: 跨语言、实现简单，初次使用较麻烦，需要避免使用问题和场景限制。


## MessagePack

#### 优点

1. 跨语言，多语言支持。
2. 序列化反序列化效率高（比json快一倍,文件体积小。
3. 兼容Json数据格式。

#### 缺点

1. 缺乏复杂模型支持。msgpack对复杂的数据类型（List、Map）支持的不够，序列化没有问题，但是反序列比较麻烦。
2. 维护成本较高。msgpack通过value的顺序来定位属性的，需要在不同的语言中都要维护同样的模型以及模型中属性的顺序。
3. 不支持模型嵌套。msgpack无法支持在模型中包含和嵌套其他自定义的模型。

